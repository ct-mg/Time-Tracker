<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>ChurchTools Extension</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
                height: 100vh;
                display: flex;
                flex-direction: column;
            }

            #menu-bar {
                background: #2c3e50;
                color: white;
                display: flex;
                padding: 0;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }

            .menu-item {
                padding: 1rem 1.5rem;
                cursor: pointer;
                border: none;
                background: none;
                color: white;
                font-size: 1rem;
                transition: background 0.2s;
                border-bottom: 3px solid transparent;
            }

            .menu-item:hover {
                background: rgba(255, 255, 255, 0.1);
            }

            .menu-item.active {
                background: rgba(255, 255, 255, 0.15);
                border-bottom-color: #3498db;
            }

            #app {
                flex: 1;
                overflow: auto;
            }
        </style>
    </head>
    <body>
        <nav id="menu-bar">
            <button class="menu-item active" data-entry="main">Extension</button>
            <button class="menu-item" data-entry="admin">Settings</button>
        </nav>
        <div id="app"></div>
        <script type="module" src="/src/index.ts"></script>
        <script type="module">
            import { renderExtension, loadEntryPoint } from '/src/index.ts';

            let currentInstance = null;

            async function switchView(entryPointName) {
                // Destroy previous instance
                if (currentInstance) {
                    await currentInstance.destroy();
                    currentInstance = null;
                }

                // Clear the app div
                const app = document.getElementById('app');
                app.innerHTML = '';

                // Load and render new entry point
                try {
                    const entryPoint = await loadEntryPoint(entryPointName);

                    // Provide mock data for the entry points
                    const data = entryPointName === 'main'
                        ? {
                            userId: 1,
                            permissions: ['read:calendar', 'read:persons'],
                            settings: { enabled: true }
                          }
                        : {
                            settings: {
                                enabled: true,
                                apiKey: '',
                                syncInterval: 30,
                                enableAvailabilityCheck: true,
                                enableNotifications: true,
                                enableDebugMode: false
                            },
                            extensionInfo: {
                                name: 'Extension Boilerplate',
                                version: '1.0.0',
                                key: 'extension-boilerplate'
                            }
                          };

                    currentInstance = await renderExtension('app', entryPoint, data);
                } catch (error) {
                    console.error('Failed to load entry point:', error);
                    app.innerHTML = `
                        <div style="padding: 2rem; color: #e74c3c;">
                            <h2>Error loading ${entryPointName}</h2>
                            <p>${error.message}</p>
                        </div>
                    `;
                }
            }

            // Handle menu clicks
            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    // Update active state
                    document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
                    e.target.classList.add('active');

                    // Switch view
                    const entryPoint = e.target.dataset.entry;
                    switchView(entryPoint);
                });
            });

            // Load default view (main)
            switchView('main');
        </script>
    </body>
</html>
