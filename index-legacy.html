<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ChurchTools Extension</title>
</head>

<body>
    <div id="app"></div>
    <script type="module">
        import { renderExtension, loadEntryPoint } from './src/index.ts';

        (async () => {
            try {
                // Determine entry point ID based on hash or query param or filename
                let entryPointId = 'main';

                const pathname = window.location.pathname;
                const hash = window.location.hash;
                const urlParams = new URLSearchParams(window.location.search);

                // Check hash first (preferred)
                if (hash === '#admin') {
                    entryPointId = 'admin';
                }
                // Fallback to filename (legacy)
                else if (pathname.endsWith('admin.html')) {
                    entryPointId = 'admin';
                }
                // Fallback to query param (legacy)
                else if (urlParams.get('ep') === 'admin') {
                    entryPointId = 'admin';
                }

                console.log(`[TimeTracker] Loading entry point: ${entryPointId}`);

                const entryPoint = await loadEntryPoint(entryPointId);
                await renderExtension('app', entryPoint, {});
            } catch (error) {
                console.error('Failed to load extension:', error);
                document.getElementById('app').innerHTML = `<div style="color: red; padding: 20px;">Error loading extension: ${error.message}</div>`;
            }
        })();
    </script>
</body>

</html>